pollers:
  oldPipelineCleanup:
    enabled: true                  # This enables old pipeline execution cleanup (default: false)
    intervalMs: 3600000            # How many milliseconds between pipeline cleanup runs (default: 1hr or 3600000)
    thresholdDays: 30              # How old a pipeline execution must be to be deleted (default: 30)
    minimumPipelineExecutions: 5   # How many executions to keep around (default: 5)

tasks:
  daysOfExecutionHistory: 180      # How many days to keep old task executions around.
  useManagedServiceAccounts: false
  delete-pipeline:
    timeout-millis: 60000  
job:
  preconfigured:
    kubernetes:
      - label: Pipeline sync to GitHub-OpsMx
        cloudProvider: kubernetes
        credentials: default
        description: Backup the applications and pipelines from Spinnaker to the GitHub
        account: default
        application: "${execution.application}"
        type: pipelineSyncToGit
        waitForCompletion: true
        parameters:
          - defaultValue: "app1,app2,..."
            description: "Please enter spinnaker applications separated by comma"
            label: Spinnaker applications
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: spinnaker_applications
          - defaultValue: "pipeline1,pipeline2..."
            description: "Please enter spinnaker pipelines separated by comma"
            label: Pipieline names
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: spinnaker_pipelines
          - defaultValue: ""
            description: "Please enter the Specific branch to upload APP/pipeline data to github repo,It is optional if not specified default branch is taken from the configmap"
            label: Branch
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: branch_ui
          - defaultValue: ""
            description: "Please enter the path to upload/download APP/pipeline data to github specific directory,It is optional if not specified default path is taken from the configmap"
            label: SavePath
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: rootfolder_ui
        manifest:
            apiVersion: batch/v1
            kind: Job
            metadata:
              generateName: pipepromot-
              namespace: SPINNAKER_NAMESPACE
              labels:
                 stage: opsmx-custom
                 stagetype: pipelinepromotion
            spec:
              backoffLimit: 0
              template:
                spec:
                  containers:
                  - command: ["bash", "scripts/deployer.sh"]
                    image: 'opsmxdev/pipepromot:1.0'
                    imagePullPolicy: IfNotPresent
                    name: pipepromot
                    volumeMounts:
                    - mountPath: /home/opsmx/scripts
                      name: pipe-promot-scripts
                    - mountPath: /home/opsmx/config
                      name: pipe-promot-config
                    - mountPath: /home/opsmx/.spin
                      name: spin-cli-config
                    - name: git-token
                      mountPath: /etc/git-secret
                      readOnly: false
                    env:
                      - name: spinnaker_applications
                        value: 'will be replaced'
                      - name: spinnaker_pipelines
                        value: 'will be replaced'
                      - name: branch_ui
                        value: 'will be replaced'
                      - name: rootfolder_ui
                        value: 'will be replaced'
                      - name: command
                        value: 'upload'
                      - name: git_secret_token
                        valueFrom:
                          secretKeyRef:
                            name: git-token
                            key: git_secret_token
                      - name: git_pr_token
                        valueFrom:
                          secretKeyRef:
                            name: git-token
                            key: git_pr_token
                      - name: git_secret_sshkey
                        value: ""
                        #valueFrom:
                        #  secretKeyRef:
                        #    name: git-token
                        #    key: git_secret_sshkey
                  volumes:
                  - configMap:
                      defaultMode: 420
                      name: pipe-promot-config
                    name: pipe-promot-config
                  - configMap:
                      defaultMode: 420
                      name: pipe-promot-scripts
                    name: pipe-promot-scripts
                  - name: spin-cli-config
                    secret:
                      defaultMode: 420
                      secretName: spin-cli-config
                  - name: git-token
                    secret:
                      defaultMode: 420
                      secretName: git-token
                  restartPolicy: Never
                  serviceAccountName: default
      - label: Pipeline sync to Spinnaker-OpsMx
        cloudProvider: kubernetes
        credentials: default
        description: Syncup the applications and pipelines from GitHub to the Spinnaker
        account: default
        application: "${execution.application}"
        type: pipelineSyncToSpinnaker
        waitForCompletion: true
        parameters:
          - defaultValue: "app1,app2,..."
            description: "Please enter spinnaker applications separated by comma"
            label: Spinnaker Applications
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: spinnaker_applications
          - defaultValue: "pipeline1,pipeline2..."
            description: "Please enter spinnaker pipelines separated by comma"
            label: Pipieline Names
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: spinnaker_pipelines
          - defaultValue: ""
            description: "Please enter the Specific branch to download APP/pipeline data from github repo, It is optional if not specified default branch is taken from the configmap"
            label: Branch
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: branch_ui
          - defaultValue: ""
            description: "Please enter the path to upload/download APP/pipeline data to github specific directory,It is optional if not specified default path is taken from the configmap"
            label: SavePath
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: rootfolder_ui
        manifest:
            apiVersion: batch/v1
            kind: Job
            metadata:
              generateName: pipepromot-
              namespace: SPINNAKER_NAMESPACE
              labels:
                 stage: opsmx-custom
                 stagetype: pipelinepromotion
            spec:
              backoffLimit: 0
              template:
                spec:
                  containers:
                  - command: ["bash", "scripts/deployer.sh"]
                    image: 'opsmxdev/pipepromot:1.0'
                    imagePullPolicy: IfNotPresent
                    name: pipepromot
                    volumeMounts:
                    - mountPath: /home/opsmx/scripts
                      name: pipe-promot-scripts
                    - mountPath: /home/opsmx/config
                      name: pipe-promot-config
                    - mountPath: /home/opsmx/.spin
                      name: spin-cli-config
                    - name: git-token
                      mountPath: /etc/git-secret
                      readOnly: false
                    env:
                      - name: spinnaker_applications
                        value: 'will be replaced'
                      - name: spinnaker_pipelines
                        value: 'will be replaced'
                      - name: branch_ui
                        value: 'will be replaced'
                      - name: rootfolder_ui
                        value: 'will be replaced'
                      - name: command
                        value: 'download'
                      - name: git_secret_token
                        valueFrom:
                          secretKeyRef:
                            name: git-token
                            key: git_secret_token
                      - name: git_pr_token
                        valueFrom:
                          secretKeyRef:
                            name: git-token
                            key: git_pr_token
                      - name: git_secret_sshkey
                        value: ""
                        #valueFrom:
                        #  secretKeyRef:
                        #    name: git-token
                        #    key: git_secret_sshkey
                  volumes:
                  - configMap:
                      defaultMode: 420
                      name: pipe-promot-config
                    name: pipe-promot-config
                  - configMap:
                      defaultMode: 420
                      name: pipe-promot-scripts
                    name: pipe-promot-scripts
                  - name: spin-cli-config
                    secret:
                      defaultMode: 420
                      secretName: spin-cli-config
                  - name: git-token
                    secret:
                      defaultMode: 420
                      secretName: git-token
                  restartPolicy: Never
                  serviceAccountName: default
      - label: "Update PR-OpsMx"
        cloudProvider: kubernetes
        credentials: default
        application: "${execution.application}"
        description: Update the PR with the comment
        account: default
        type: customPRStage
        waitForCompletion: true
        parameters:
          - defaultValue: ""
            description: Please enter the webhook url.
            label: Webhook URL
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: url
          - defaultValue: ""
            description: Please enter method.
            label: Method
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: method
          - defaultValue: ""
            description: Please enter payload.
            label: Payload
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: payload
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            generateName: updateprjob-
            namespace: SPINNAKER_NAMESPACE
            labels:
               stage: opsmx-custom
               stagetype: updatepr
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - sh
                      - /tmp/initscript/run.sh
                    env:
                      - name: url
                        value:
                      - name: method
                        value:
                      - name: payload
                        value:
                      - name: accesstoken
                        valueFrom:
                         secretKeyRef:
                          key: accesstoken
                          name: updatepr-secrets
                    image: 'opsmxdev/apline-with-curl'
                    imagePullPolicy: Always
                    name: updatepr
                    volumeMounts:
                      - mountPath: /tmp/initscript/
                        name: initscript
                restartPolicy: Never
                volumes:
                  - configMap:
                      default: 420
                      name: updatepr-config
                    name: initscript
      - label: Custom notification-OpsMx
        cloudProvider: kubernetes
        credentials: default
        application: "${execution.application}"
        description: Email notification that supports SPEL expression as mailid
        account: default
        type: customnotification
        waitForCompletion: true
        parameters:
          - defaultValue: ""
            description: Please enter the Email address
            label: Email
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: email
          - defaultValue: ""
            description: Please enter CC mail address with "," as saperated for more mails.
            label: CC Address
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: ccmail
          - defaultValue: ""
            description: Please enter Subject
            label: Subject
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: subject
          - defaultValue: ""
            description: Please enter body message.
            label: Body Message
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: body
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            generateName: smtpjob-
            namespace: SPINNAKER_NAMESPACE
            labels:
               stage: opsmx-custom
               stagetype: customnotification
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - sh
                      - /tmp/initscript/run.sh
                    env:
                      - name: email
                        value:
                      - name: ccmail
                        value:
                      - name: subject
                        value:
                      - name: body
                        value:
                      - name: ssmtpemail
                        valueFrom:
                         secretKeyRef:
                          key: ssmtpemail
                          name: ssmtp-secrets
                      - name: emailpassword
                        valueFrom:
                         secretKeyRef:
                          key: emailpassword
                          name: ssmtp-secrets
                    image: 'opsmxdev/apline-with-curl'
                    imagePullPolicy: Always
                    name: email-notify
                    volumeMounts:
                      - mountPath: /tmp/initscript/
                        name: initscript
                restartPolicy: Never
                volumes:
                  - configMap:
                      default: 420
                      name: email-config
                    name: initscript
      - label: Ansible-OpsMx
        cloudProvider: kubernetes
        credentials: default
        application: "${execution.application}"
        description: Run playbooks to a single VM node
        account: default
        type: customAnsibleStage
        waitForCompletion: true
        parameters:
          - defaultValue: ""
            description: Please enter the  Git repo url with out https://
            label: Git repo
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: gitrepo
          - defaultValue: ""
            description: Please enter ansiblefile location.
            label: Ansible file
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: ansiblefileepo
          - defaultValue: ""
            description: Please enter override inventoryfile.
            label: Inventory file
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: inventoryfile
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            generateName: ansiblejob-
            namespace: SPINNAKER_NAMESPACE
            labels:
               stage: opsmx-custom
               stagetype: ansible
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - bash
                      - /tmp/initscript/run.sh
                    env:
                      - name: gitrepo
                        value:
                      - name: ansiblefile
                        value:
                      - name: inventoryfile
                        value:
                      - name: gitusername
                        valueFrom:
                         secretKeyRef:
                          key: gitusername
                          name: ansible-secrets
                      - name: gitpassword
                        valueFrom:
                         secretKeyRef:
                          key: gitpassword
                          name: ansible-secrets
                      - name: nodeuser
                        valueFrom:
                         secretKeyRef:
                          key: nodeuser
                          name: ansible-secrets
                      - name: userpassword
                        valueFrom:
                         secretKeyRef:
                          key: userpassword
                          name: ansible-secrets
                    image: 'opsmx11/ansible-job-image:v2'
                    imagePullPolicy: Always
                    name: ansible-test
                    volumeMounts:
                      - mountPath: /tmp/initscript/
                        name: initscript
                restartPolicy: Never
                volumes:
                  - configMap:
                      default: 420
                      name: ansible-config
                    name: initscript
      - label: Terraform plan-OpsMx
        cloudProvider: kubernetes
        application: "${execution.application}"
        description: Stage for Terraform plan operation
        account: default
        type: customTSPlanJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: ""
            description: "Please enter the AWS Assure role configured account name."
            label: AWS account name
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: awsrole
          - defaultValue: ""
            description: "Please enter the namespace of spinnaker in HA mode."
            label: Spinnaker Namespace
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: namespace
          - defaultValue: ""
            description: "Please enter the artifact account name from artifactsaccounts.json, Account where you have tf script present.It is optional if not specified default branch is taken from the configmap"
            label: Tf script account
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: scriptaccount
          - defaultValue: ""
            description: "Please enter the Git Repo Account of TF script."
            label: Tf Plan script Repo
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: repo
          - defaultValue: ""
            description: Please enter Location of terraform script in the repo.
            label: Tf Location
            mapping: 'manifest.spec.template.spec.containers[0].env[4].value'
            name: location
          - defaultValue: ""
            description: Please enter overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[5].value'
            name: overridefile
          - defaultValue: ""
            description: Please enter terraform workspace name.
            label: Terraform Workspace
            mapping: 'manifest.spec.template.spec.containers[0].env[6].value'
            name: TF_WORKSPACE
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            generateName: terraspinplanjob-
            namespace: SPINNAKER_NAMESPACE
            labels:
               stage: opsmx-custom
               stagetype: terraform
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - role.sh
                    env:
                      - name: awsrole
                        value:
                      - name: namespace
                        value:
                      - name: scriptaccount
                        value:
                      - name: repo
                        value:
                      - name: location
                        value:
                      - name: overridefile
                        value:
                      - name: TF_WORKSPACE
                        value:
                      - name: command
                        value: plan
                    image: 'quay.io/opsmxpublic/customterraformstage:terraform-1.1.7-isd-backendconfig'
                    imagePullPolicy: Always
                    name: terraspinplan
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - secret:
                      secretName: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config
      - label: Terraform apply-OpsMx
        cloudProvider: kubernetes
        application: "${execution.application}"
        description: Stage for Terraform apply operation
        account: default
        type: customTSApplyJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: ""
            description: "Please enter the AWS Assure role configured account name."
            label: AWS account name
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: awsrole
          - defaultValue: ""
            description: "Please enter the namespace of spinnaker in HA mode."
            label: Spinnaker Namespace
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: namespace
          - defaultValue: ""
            description: "Please enter the artifact account name from artifactsaccounts.json, Account where you have tf script present."
            label: Tf script account
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: scriptaccount
          - defaultValue: ""
            description: "Please enter the Git Repo Account of TF script."
            label: Tf Plan script Repo
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: repo
          - defaultValue: ""
            description: Please enter Location of terraform script in the repo.
            label: Tf Location
            mapping: 'manifest.spec.template.spec.containers[0].env[4].value'
            name: location
          - defaultValue: ""
            description: Please enter overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[5].value'
            name: overridefile
          - defaultValue: ""
            description: Please enter terraform workspace name.
            label: Terraform Workspace
            mapping: 'manifest.spec.template.spec.containers[0].env[6].value'
            name: TF_WORKSPACE
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            generateName: terraspinapplyjob-
            namespace: SPINNAKER_NAMESPACE
            labels:
               stage: opsmx-custom
               stagetype: terraform
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - role.sh
                    env:
                      - name: awsrole
                        value:
                      - name: namespace
                        value:
                      - name: scriptaccount
                        value:
                      - name: repo
                        value:
                      - name: location
                        value:
                      - name: overridefile
                        value:
                      - name: TF_WORKSPACE
                        value:
                      - name: command
                        value: apply
                    image: 'quay.io/opsmxpublic/customterraformstage:terraform-1.1.7-isd-backendconfig'
                    imagePullPolicy: Always
                    name: terraspinapply
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - secret:
                      secretName: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config
      - label: Terraform destroy-OpsMx
        application: "${execution.application}"
        cloudProvider: kubernetes
        credentials: default
        description: Stage for Terraform destroy operation
        account: default
        type: customTSDestroyJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: ""
            description: "Please enter the AWS Assure role configured account name."
            label: AWS account name
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: awsrole
          - defaultValue: ""
            description: "Please enter the namespace of spinnaker in HA mode."
            label: Spinnaker Namespace
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: namespace
          - defaultValue: ""
            description: "Please enter the artifact account name from artifactsaccounts.json, Account where you have tf script present."
            label: Tf script account
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: scriptaccount
          - defaultValue: ""
            description: "Please enter the Git Repo Account of TF script."
            label: Tf Plan script Repo
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: repo
          - defaultValue: ""
            description: Please enter Location of terraform script in the repo.
            label: Tf Location
            mapping: 'manifest.spec.template.spec.containers[0].env[4].value'
            name: location
          - defaultValue: ""
            description: Please enter overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[5].value'
            name: overridefile
          - defaultValue: ""
            description: Please enter terraform workspace name.
            label: Terraform Workspace
            mapping: 'manifest.spec.template.spec.containers[0].env[6].value'
            name: TF_WORKSPACE
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            generateName: terraspindestroyjob-
            namespace: SPINNAKER_NAMESPACE
            labels:
               stage: opsmx-custom
               stagetype: terraform
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - role.sh
                    env:
                      - name: awsrole
                        value:
                      - name: namespace
                        value:
                      - name: scriptaccount
                        value:
                      - name: repo
                        value:
                      - name: location
                        value:
                      - name: overridefile
                        value:
                      - name: TF_WORKSPACE
                        value:
                      - name: command
                        value: destroy
                    image: 'quay.io/opsmxpublic/customterraformstage:terraform-1.1.7-isd-backendconfig'
                    imagePullPolicy: Always
                    name: terraspindestroy
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - secret:
                      secretName: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config

webhook:
  preconfigured:
  - label: "Ansible AWX - Create Instance Group"
    type: AnsibleAWXCreateInstanceGroup
    enabled: true
    description: Stage to create an instance group in ansible awx
    method: POST
    url: http://<URL>/api/v2/instance_groups/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "credential": "${parameterValues['credentialid']}",
        "name": "${parameterValues['name']}",
        "pod_spec_override": "${parameterValues['podspecoverride']}",
        "policy_instance_list": [${parameterValues['policyinstancelist']}],
        "is_container_group": ${parameterValues['iscontainergroup']},
        "policy_instance_minimum": ${parameterValues['policyinstanceminimum']},
        "policy_instance_percentage": ${parameterValues['policyinstancepercentage']}
      }
    parameters:
    - label: Name
      name: name
      description: Name of this instance group. (string, required)
      type: string
    - label: Credential Id
      name: credentialid
      description: Credential id. Leave it blank if not needed
      type: string
    - label: Policy Instance Percentage
      name: policyinstancepercentage
      description: Minimum percentage of all instances that will be automatically assigned to this group when new instances come online. (integer, default=0)
      type: string
    - label: Policy Instance Minimum
      name: policyinstanceminimum
      description: Static minimum number of Instances that will be automatically assign to this group when new instances come online. (integer, default=0)
      type: string
    - label: Policy Instance List
      name: policyinstancelist
      description: List of exact-match Instances that will be assigned to this group (json, default=``). Provide value in "" and multiple values by coma seperated
      type: string
    - label: Pod Spec Override
      name: podspecoverride
      description: (string, default="")
      type: string
    - label: Is Container Group
      name: iscontainergroup
      description: true or false
      type: string

  - label: "Ansible AWX - Update Credential of Instance Group"
    type: AnsibleAWXUpdatecredentialofInstanceGroup
    enabled: true
    description: Stage to update credential of an instance group in ansible awx
    method: PATCH
    url: http://<URL>/api/v2/instance_groups/${parameterValues['name']}/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "credential": "${parameterValues['credentialid']}",
        "name": "${parameterValues['name']}"
        "is_container_group": true
      }
    parameters:
    - label: Name
      name: name
      description: Name of this instance group. (string, required)
      type: string
    - label: Credential Id
      name: credentialid
      description: Id of credential to which you want to change
      type: string

  - label: "Ansible AWX - Update Instance List of Instance Group"
    type: AnsibleAWXUpdateInstanceListofInstanceGroup
    enabled: true
    description: Stage to update instance list an instance group in ansible awx
    method: PATCH
    url: http://<URL>/api/v2/instance_groups/${parameterValues['name']}/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "name": "${parameterValues['name']}",
        "policy_instance_list": [${parameterValues['policyinstancelist']}]
      }
    parameters:
    - label: Name
      name: name
      description: Name of this instance group. (string, required)
      type: string
    - label: Policy Instance List
      name: policyinstancelist
      description: List of exact-match Instances that will be assigned to this group (json, default=``). Provide value in "" and multiple values by coma seperated
      type: string

  - label: "Ansible AWX - Update Policy Instance Minimum of Instance Group"
    type: AnsibleAWXUpdatePolicyInstanceMinimumofInstanceGroup
    enabled: true
    description: Stage to update policy instance minimum an instance group in ansible awx
    method: PATCH
    url: http://<URL>/api/v2/instance_groups/${parameterValues['name']}/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "name": "${parameterValues['name']}",
        "policy_instance_minimum": ${parameterValues['policyinstanceminimum']}
      }
    parameters:
    - label: Name
      name: name
      description: Name of this instance group. (string, required)
      type: string
    - label: Policy Instance Minimum
      name: policyinstanceminimum
      description: Static minimum number of Instances that will be automatically assign to this group when new instances come online. (integer, default=0)
      type: string

  - label: "Ansible AWX - Update Policy Instance Percentage of Instance Group"
    type: AnsibleAWXUpdatePolicyInstancePercentageofInstanceGroup
    enabled: true
    description: Stage to update policy instance percentage of an instance group in ansible awx
    method: PATCH
    url: http://<URL>/api/v2/instance_groups/${parameterValues['name']}/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "name": "${parameterValues['name']}",
        "policy_instance_percentage": ${parameterValues['policyinstancepercentage']}
      }
    parameters:
    - label: Name
      name: name
      description: Name of this instance group. (string, required)
      type: string
    - label: Policy Instance Percentage
      name: policyinstancepercentage
      description: Minimum percentage of all instances that will be automatically assigned to this group when new instances come online. (integer, default=0)
      type: string

  - label: "Ansible AWX - Update Pod Spec Override of Instance Group"
    type: AnsibleAWXUpdatePodSpecOverrideofInstanceGroup
    enabled: true
    description: Stage to update pod spec override of an instance group in ansible awx
    method: PATCH
    url: http://<URL>/api/v2/instance_groups/${parameterValues['name']}/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "name": "${parameterValues['name']}",
        "pod_spec_override": "${parameterValues['podspecoverride']}"
      }
    parameters:
    - label: Name
      name: name
      description: Name of this instance group. (string, required)
      type: string
    - label: Pod Spec Override
      name: podspecoverride
      description: (string, default="")
      type: string

  - label: "Ansible AWX - Name of Instance Group"
    type: AnsibleAWXUpdateNameofInstanceGroup
    enabled: true
    description: Stage to update name of an instance group in ansible awx
    method: PATCH
    url: http://<URL>/api/v2/instance_groups/${parameterValues['currentname']}/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "name": "${parameterValues['changename']}"
      }
    parameters:
    - label: Current Name
      name: currentname
      description: Name of the instance group which exists
      type: string
    - label: Change Name
      name: changename
      description: To what you need to change
      type: string
  - label: "Ansible AWX - Create Job Template"
    type: AnsibleAWXCreateJobTemplate
    enabled: true
    description: Stage to create job template in ansible awx
    method: POST
    url: http://<URL>/api/v2/job_templates/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "allow_callbacks": "${parameterValues['allowcallbacks']}",
        "allow_simultaneous": "${parameterValues['allowsimultaneous']}",
        "ask_credential_on_launch": "${parameterValues['askcredentialonlaunch']}",
        "ask_diff_mode_on_launch": "${parameterValues['askdiffmodeonlaunch']}",
        "ask_inventory_on_launch": "${parameterValues['askinventoryonlaunch']}",
        "ask_job_type_on_launch": "${parameterValues['askjobtypeonlaunch']}",
        "ask_limit_on_launch": "${parameterValues['asklimitonlaunch']}",
        "ask_scm_branch_on_launch": "${parameterValues['askscmbranchonlaunch']}",
        "ask_skip_tags_on_launch": "${parameterValues['askskiptagsonlaunch']}",
        "ask_tags_on_launch": "${parameterValues['asktagsonlaunch']}",
        "ask_variables_on_launch": "${parameterValues['askvariablesonlaunch']}",
        "ask_verbosity_on_launch": "${parameterValues['askverbosityonlaunch']}",
        "become_enabled": "${parameterValues['becomeenabled']}",
        "description": "${parameterValues['description']}",
        "diff_mode": "${parameterValues['diffmode']}",
        "extra_vars": "${parameterValues['extravars']}",
        "forks": "${parameterValues['forks']}",
        "host_config_key": "${parameterValues['hostconfigkey']}",
        "job_slice_count": "${parameterValues['jobslicecount']}",
        "job_tags": "${parameterValues['jobtags']}",
        "job_type": "${parameterValues['jobtype']}",
        "limit": "${parameterValues['limit']}",
        "name": "${parameterValues['name']}",
        "playbook": "${parameterValues['playbook']}",
        "scm_branch": "${parameterValues['scmbranch']}",
        "skip_tags": "${parameterValues['skiptags']}",
        "timeout": "${parameterValues['timeout']}",
        "use_fact_cache": "${parameterValues['usefactcache']}",
        "verbosity": "${parameterValues['verbosity']}",
        "webhook_service": "${parameterValues['webhookservice']}",
        "project": "${parameterValues['project']}",
        "webhook_credential": "${parameterValues['webhook_credential']}",
        "inventory": "${parameterValues['inventory']}",
        "execution_environment": "${parameterValues['executionenvironment']}"
      }
    parameters:
    - label: Allow Callbacks
      name: allowcallbacks
      description: true or false
      type: string
    - label: Allow Simultaneous
      name: allowsimultaneous
      description: true or false
      type: string
    - label: Ask Credential on Launch
      name: askcredentialonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Diff Mode on Launch
      name: askdiffmodeonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Inventory On Launch
      name: askinventoryonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Job Type on Launch
      name: askjobtypeonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Limit on Launch
      name: asklimitonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Scm Branch on Launch
      name: askscmbranchonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Skip Tags On Launch
      name: askskiptagsonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Tags on Launch
      name: asktagsonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Variables on Launch
      name: askvariablesonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Ask Verbosity on Launch
      name: askverbosityonlaunch
      description: true or false
      type: string
      defaultValue: false
    - label: Become Enabled
      name: becomeenabled
      description: true or false
      type: string
      defaultValue: false
    - label: Description
      name: description
      description: Description about job template
      type: string
    - label: Diff Mode
      name: diffmode
      description: true or false. If enabled, textual changes made to any templated files on the host are shown in the standard output.
      type: string
      defaultValue: false
    - label: Extra Vars
      name: extravars
      description: (json, default=``)
      type: string
    - label: Forks
      name: forks
      description: (integer, default=0)
      type: string
      defaultValue: 0
    - label: Host Config Key
      name: hostconfigkey
      description: (string, default="")
      type: string
    - label: Job Slice Count
      name: jobslicecount
      description: The number of jobs to slice into at runtime. Will cause the Job Template to launch a workflow if value is greater than 1. (integer, default=1)
      type: string
      defaultValue: 1
    - label: Job Tags
      name: jobtags
      description: (string, default="")
      type: string
    - label: Job Type
      name: jobtype
      description: Run(default) or Check
      type: string
      defaultValue: Run
    - label: Limit
      name: limit
      description: (string, default="")
      type: string
    - label: Name
      name: name
      description: name
      type: string
    - label: playbook
      name: playbook
      description: (string, default="") Eg:- hello_world.yml
      type: string
    - label: Scm Branch
      name: scmbranch
      description: Branch to use in job run. Project default used if blank. Only allowed if project allow_override field is set to true. (string, default="")
      type: string
    - label: Skip Tags
      name: skiptags
      description: (string, default="")
      type: string
    - label: Timeout
      name: timeout
      description: The amount of time (in seconds) to run before the task is canceled. (integer, default=0)
      type: string
      defaultValue: 0
    - label: Use Fact Cache
      name: usefactcache
      description:  If enabled, Tower will act as an Ansible Fact Cache Plugin; persisting facts at the end of a playbook run to the database and caching facts for use by Ansible. (boolean, default=False)
      type: string
      defaultValue: false
    - label: Verbosity
      name: verbosity
      description: 0(Normal)(default) - 1(Verbose) - 2(More Verbose) - 3(Debug) - 4(Connection Debug) - 5(WinRM Debug)
      type: string
      defaultValue: 0
    - label: webhook_service
      name: webhook_service
      description: Service that webhook requests will be accepted from (choice) Eg:- github gitlab
      type: string
    - label: Project
      name: project
      description: (id, default=``)
      type: string
    - label: Webhook Credential
      name: webhookcredential
      description: Personal Access Token for posting back the status to the service API (id, default=null)
      type: string
      defaultValue: null
    - label: Inventory
      name: inventory
      description: (id, default=``)
      type: string
    - label: Execution Environment
      name: executionenvironment
      description: (id, default=null)
      type: string
      defaultValue: null

  - label: "Ansible AWX - Create Project"
    type: AnsibleAWXCreateProject
    enabled: true
    description: Stage to create a project in ansible awx
    method: POST
    url: http://<URL>/api/v2/projects/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "name": "${parameterValues['name']}",
        "description": "${parameterValues['description']}",
        "local_path": "${parameterValues['localpath']}",
        "scm_type": "${parameterValues['scmtype']}",
        "scm_url": "${parameterValues['scmurl']}",
        "scm_branch": "${parameterValues['scmbranch']}",
        "scm_refspec": "${parameterValues['scmrefspec']}",
        "scm_clean": "${parameterValues['scmclean']}",
        "scm_delete_on_update": "${parameterValues['scmdeleteonupdate']}",
        "credential": "${parameterValues['credential']}",
        "timeout": "${parameterValues['timeout']}",
        "organization": "${parameterValues['organization']}",
        "scm_update_on_launch": "${parameterValues['scmupdateonlaunch']}",
        "scm_update_cache_timeout": "${parameterValues['scmupdatecachetimeout']}",
        "allow_override": "${parameterValues['allow_override']}",
        "custom_virtualenv": "${parameterValues['customvirtualenv']}"
      }
    parameters:
    - label: Name
      name: name
      description: Name of the project
      type: string
    - label: Description
      name: description
      description: Description for the project
      type: string
    - label: Local Path
      name: localpath
      description: Local path (relative to PROJECTS_ROOT) containing playbooks and related files for this project. (string, default="")
      type: string
    - label: Scm Type
      name: scmtype
      description: Specifies the source control system used to store the project. (choice). "" (Manual)(default) - git (Git) - hg (Mercurial) - svn (Subversion) - insights (Red Hat Insights) - archive (Remote Archive)
      type: string
    - label: Scm Url
      name: scmurl
      description: The location where the project is stored. (string, default="") Eg:- https://github.com/ansible/test-playbooks.git
      type: string
    - label: Scm Branch
      name: scmbranch
      description: Specific branch, tag or commit to checkout. (string, default="")
      type: string
    - label: Scm Refspec
      name: scmrefspec
      description: For git projects, an additional refspec to fetch. (string, default="")
      type: string
    - label: Scm Clean
      name: scmclean
      description: true or false. Discard any local changes before syncing the project. (boolean, default=False)
      type: string
      defaultValue: false
    - label: Scm Delete on Update
      name: scmdeleteonupdate
      description: true or false. Delete the project before syncing. (boolean, default=False)
      type: string
      defaultValue: false
    - label: Credential
      name: credential
      description: (id, default=``)
      type: string
    - label: Timeout
      name: timeout
      description: The amount of time (in seconds) to run before the task is canceled. (integer, default=0)
      type: string
      defaultValue: 0
    - label: Organization
      name: organization
      description: The organization used to determine access to this template. (id, default=``)
      type: string
    - label: Scm Update on Launch
      name: scmupdateonlaunch
      description: Update the project when a job is launched that uses the project. (boolean, default=False)
      type: string
      defaultValue: false
    - label: Scm Update Cache Timeout
      name: scmupdatecachetimeout
      description: The number of seconds after the last project update ran that a new project update will be launched as a job dependency. (integer, default=0)
      type: string
      defaultValue: 0
    - label: Allow Override
      name: allowoverride
      description: Allow changing the SCM branch or revision in a job template that uses this project. (boolean, default=False)
      type: string
      defaultValue: false
    - label: Custom Virtualenv
      name: customvirtualenv
      description: Local absolute file path containing a custom Python virtualenv to use (string, default="")
      type: string

  - label: "Ansible AWX - Get List of Job Templates"
    type: AnsibleAWXUGetListofJobTemplates
    enabled: true
    description: Stage to list the job templates available
    method: GET
    url: http://<URL>/api/v2/job_templates/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: ""
    parameters: ""

  - label: "Ansible AWX - Invoke a Job Template"
    type: AnsibleAWXInvokeJobTemplate
    enabled: true
    description: Stage to invoke job template in ansible awx.
    method: POST
    url: http://<URL>/api/v2/job_templates/${parameterValues['jobtemplateid']}/launch/
    customHeaders:
      Authorization: Basic USER:PASSWORD-BASE64
      Content-Type: application/json
    payload: ""
    parameters:
    - label: Job Template Id
      name: jobtemplateid
      description: Job template id
      type: string
  - label: "ServiceNow: Create a change request-OpsMx"
    type: CreateServiceNowChangeRequest
    enabled: true
    description: ServiceNow normal request creation
    method: POST
    url: SERVICENOW_URL/api/sn_chg_rest/v1/change
    customHeaders:
      Authorization: Basic SERVICENOW_BASE64_USR_PASSWD
      Content-Type: application/json
    payload: |-
      {
        "delivery_plan":"${parameterValues['deliveryplan']}",
        "impact":"${parameterValues['impact']}",
        "priority":"${parameterValues['priority']}",
        "change_plan":"${parameterValues['changeplan']}",
        "short_description":"${parameterValues['shortdescription']}",
        "description":"${parameterValues['description']}",
        "implementation_plan":"${parameterValues['implementationplan']}",
        "backout_plan":"${parameterValues['backoutplan']}",
        "type":"${parameterValues['type']}"
      }
    parameters:
    - label: Delivery Plan
      name: deliveryplan
      description: Steps to be done to complete the request can be defined as a Delivery Plan.
      type: string
    - label: Impact
      name: impact
      description: Impact is a measure of the effect of an incident, problem, or change on business processes( 1-High, 2-Medium, 3-Low ). Mention 1 or 2 or 3 in the column.
      type: string
    - label: Priority
      name: priority
      description: Priority is based on impact and urgency, it identifies how quickly the service desk should address the task ( 1-Critical, 2-High, 3-Moderate, 4-Low )
      type: string
    - label: Change Plan
      name: changeplan
      description: Change Request Lifecycle model like (Normal, Emergency, or Standard etc.)
      type: string
    - label: Short Description
      name: shortdescription
      description: Summary of the change.
      type: string
    - label: Description
      name: description
      description: Detailed description of the change.
      type: string
    - label: Implementation Plan
      name: implementationplan
      description: Name of the plan that is to be implemented.
      type: string
    - label: Backout Plan
      name: backoutplan
      description: Backout plan implemented prior to any software or system upgrade, installation, integration or transformation to ensure automated system business operations.
      type: string
    - label: Type
      name: type
      description: Type of change request ( Emergency, Normal etc )
      type: string
  - label: "ServiceNow: Change request Status-OpsMx"
    type: ChangeStateofChangeRequest
    enabled: true
    description: ServiceNow change the state of the normal request
    method: PATCH
    url: SERVICENOW_URL/api/sn_chg_rest/v1/change/${parameterValues['sysid']}
    customHeaders:
      Authorization: Basic SERVICENOW_BASE64_USR_PASSWD
      Content-Type: application/json
    payload: |-
      {
        "assignment_group":"${parameterValues['assignmentgroup']}",
        "state":"${parameterValues['state']}"
      }
    parameters:
    - label: Assignment Group
      name: assignmentgroup
      description: Approval Group that works on the change request. It populates the Assignment group field based on the support group available for the CI or the service offering consecutively Eg- CAB
      type: string
    - label: State
      name: state
      description: State of the change request. The default state is New
      type: string
    - label: sys_id
      name: sysid
      description: Sys id of the request. Can get from url of the request Eg-7067852307303010268affa08c1ed0a6
      type: string
  - label: "ServiceNow: Add a work note to the change request-OpsMx"
    type: AddWorkNotetoChangeRequst
    enabled: true
    description: ServiceNow add work note to normal request
    method: PATCH
    url: SERVICENOW_URL/api/sn_chg_rest/change/${parameterValues['sysid']}
    customHeaders:
      Authorization: Basic SERVICENOW_BASE64_USR_PASSWD
      Content-Type: application/json
    payload: |-
      {
        "work_notes":"${parameterValues['worknotes']}"
      }
    parameters:
    - label: Work Notes
      name: worknotes
      description: The state flow adds these work notes to the Work notes field of any task making this transition.
      type: string
    - label: sys_id
      name: sysid
      description: Sys id of the request. Can get from url of the request Eg-7067852307303010268affa08c1ed0a6
      type: string
  - label: "ServiceNow: Wait for state-OpsMx"
    type: waitServiceNowState
    enabled: true
    description: Waits for a specific state on a ServiceNow issue
    method: GET
    url: SERVICENOW_URL/api/sn_chg_rest/change/${parameterValues['sysid']}
    customHeaders:
      Authorization: Basic SERVICENOW_BASE64_USR_PASSWD
      Content-Type: application/json
    failPipeline: true
    progressJsonPath: "result.state.display_value"
    payload: ""
    retryStatusCodes:
      - 200
    statusJsonPath: "result.state.display_value"
    statusUrlResolution: "getMethod"
    successStatuses: ${parameterValues['success']}
    retryStatuses: ${parameterValue['retry']}
    terminalStatuses: ${parameterValues['terminate']}
    canceledStatuses: ${parameterValues['cancel']}
    waitBeforeMonitor: "1"
    waitForCompletion: true
    parameters:
    - label: Sys id
      name: sysid
      description: "Sys id of the request. Can get from url of the request Eg-7067852307303010268affa08c1ed0a6"
      type: string
      defaultValue: ""
    - label: Service Now Success States
      name: success
      description: "Service Now issue States that progress the pipeline, e.g,: In Verificaiton etc."
      type: string
      defaultValue: ""
    - label: Service Now Retry States
      name: retry
      description: "Service Now issue states that Retry the stage e.g,: New etc. Can give multiple states coma seperated"
      type: string
      defaultValue: ""
    - label: Service Now Termination States
      name: terminate
      description: "Service Now issue states that terminates the pipeline, e.g,: Done etc."
      type: string
      defaultValue: ""
    - label: Service Now Canceled States
      name: cancel
      description: "Service Now issue states that cancel the pipeline e.g,: Closed, etc."
      type: string
      defaultValue: Closed
  - label: "JIRA: Wait for state-OpsMx"
    type: waitJiraState
    enabled: true
    description: Stage that waits for a specific state on a Jira issue
    method: GET
    url: JIRA_URL/rest/api/latest/issue/${parameterValues['issue']}
    customHeaders:
      ## Provide the JIRA credentails that are in base64 encoded USER:PASSWORD/TOKEN
      Authorization: Basic JIRA_BASE64_USR_PASSWD
      Content-Type: application/json
    failPipeline: true
    progressJsonPath: "fields.status.name"
    payload: ""
    retryStatusCodes:
      - 200
    statusJsonPath: "fields.status.name"
    statusUrlResolution: "getMethod"
    successStatuses: ${parameterValues['success']}
    retryStatuses: ${parameterValue['retry']}
    terminalStatuses: ${parameterValues['terminate']}
    canceledStatuses: ${parameterValues['cancel']}
    waitBeforeMonitor: "1"
    waitForCompletion: true
    parameters:
    - label: JIRA Issue ID
      name: issue
      description: "The JIRA issue, the default relies on JIRA issue ID extraction"
      type: string
      defaultValue: ${jira_issue}
    - label: JIRA Retry States
      name: retry
      description: "JIRA issue states that Retry the stage e.g,: To Do, In Progress, etc."
      type: string
      defaultValue: To Do, In Progress
    - label: JIRA Success States
      name: success
      description: "JIRA issue States that progress the pipeline, e.g,: In Verificaiton etc."
      type: string
      defaultValue: In Verification
    - label: JIRA Temination States
      name: terminate
      description: "JIRA issue states that terminates the pipeline, e.g,: PR Raised etc."
      type: string
      defaultValue: PR Raised
    - label: JIRA Canceled States
      name: cancel
      description: "JIRA issue states that cancel the pipeline e.g,: Done, etc."
      type: string
      defaultValue: Done
  - label: "JIRA: Create an issue-OpsMx"
    type: addJiraIss
    enabled: true
    description: Stage that add an issue in Jira
    method: POST
    url: JIRA_URL/rest/api/2/issue/
    customHeaders:
     ## Provide the JIRA credentails that are in base64 encoded USER:PASSWORD/TOKEN
     Authorization: Basic JIRA_BASE64_USR_PASSWD
     Content-Type: application/json
    payload: |-
      {
        "fields": {
           "project":
            {
              "key": "${parameterValues['projectid']}"
            },
            "summary": "${parameterValues['summary']}",
            "description": "${parameterValues['description']}",
            "issuetype": {
              "name": "${parameterValues['issuetype']}"
            },
            "components": [
                {
              "id": "${parameterValues['components']}"
            }
            ],
            "priority": {
              "name": "${parameterValues['priority']}"
            }
        }
      }
    parameters:
    - label: Project ID ("ENG" or "DOCS")
      name: projectid
      description: Which JIRA project do you want to create an item in?
      type: string
    - label: Issue Type ("Improvement", "Task", "New Feature", or "Bug")
      name: issuetype
      description: issuetype
      type: string
    - label: Priority ("Low", "Medium", or "High")
      name: priority
      description: priority
      type: string
    - label: Components ("10103")
      name: components
      description: component of the project
    - label: Issue Summary
      name: summary
      description: summary
      type: string
    - label: Description
      name: description
      description: description
      type: string
  - label: "JIRA: Comment on issue-OpsMx"
    type: comJiraIss
    enabled: true
    description: Stage that posts a comment in a Jira issue
    method: POST
    url: JIRA_URL/rest/api/latest/issue/${parameterValues['issue']}/comment
    customHeaders:
      ## Provide the JIRA credentails that are in base64 encoded USER:PASSWORD/TOKEN
      Authorization: Basic JIRA_BASE64_USR_PASSWD
      Content-Type: application/json
    payload: |-
      {
        "body": "${parameterValues['message']}"
      }
    parameters:
    - label: Issue ID
      name: issue
      description: Issue
      type: string
    - label: Message
      name: message
      description: message
      type: string
  - label: "JIRA: Update issue-OpsMx"
    type: updJiraIss
    enabled: true
    description: Stage that updates an issue in Jira
    method: PUT
    url: JIRA_URL/rest/api/latest/issue/${parameterValues['issue']}
    customHeaders:
      ## Provide the JIRA credentails that are in base64 encoded USER:PASSWORD/TOKEN
      Authorization: Basic JIRA_BASE64_USR_PASSWD
      Content-Type: application/json
    payload: |-
      {
        "update": {
            "summary": [
                {
                    "set": "${parameterValues['summary']}"
                }
            ],
            "description": [
                {
                   "set": "${parameterValues['description']}"
                }
            ]
        }
      }
    parameters:
    - label: Issue ID
      name: issue
      description: Issue
      type: string
    - label: Summary
      name: summary
      description: summary
      type: string
    - label: Description
      name: description
      description: description
  - label: "JIRA: Transition issue-OpsMx"
    type: transJiraIss
    enabled: true
    description: Stage that transitions an issue in Jira
    method: POST
    url: JIRA_URL/rest/api/latest/issue/${parameterValues['issue']}/transitions
    customHeaders:
      ## Provide the JIRA credentails that are in base64 encoded USER:PASSWORD/TOKEN
      Authorization: Basic JIRA_BASE64_USR_PASSWD
      Content-Type: application/json
    payload: |-
      {
        "transition": {
          "id": "${parameterValues['targetStageID']}"
        }
      }
    parameters:
    - label: Issue ID
      name: issue
      description: Issue
      type: string
    - label: Target Stage ID
      name: targetStageID
      description: Target Stage ID (11 is "To Do", 21 is "In Progress", 31 is "In Review", 41 is "Done")
      type: string
  - label: "ServiceDesk: Create request-OpsMx"
    type: CreateServiceDeskrequest (issue)
    enabled: true
    description: Stage that create an request in ServiceDesk
    method: POST
    url: https://<URL>/rest/servicedeskapi/request
    customHeaders:
      Authorization: Basic USER/PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "serviceDeskId": "${parameterValues['projectid']}",
        "requestTypeId": "${parameterValues['requesttypeid']}",
        "requestFieldValues": {
        "summary": "${parameterValues['summary']}",
        "description": "${parameterValues['description']}"
        },
        "requestParticipants": [
          "${parameterValues['requestParticipants']}"
        ]
      }
    parameters:
    - label: Project ID
      name: projectid
      description: Which Servicedesk project do you want to create an item in?
      type: string
    - label: Request Type Id
      name: requesttypeid
      description: Request type like id "25" for IT HELP
      type: string
    - label: Summary
      name: summary
      description: summary of the request
      type: string
    - label: Request Participants
      name: requestParticipants
      description: requestParticipants of the request
      type: string
    - label: Description
      name: description
      description: Description of the request
      type: string
  - label: "ServiceDesk: Comment on issue-OpsMx"
    type: Coment ServiceDesk Issue
    enabled: true
    description: Stage that post a comment in a ServiceDesk issue
    method: POST
    url: https://<URL>/rest/servicedeskapi/request/${parameterValues['issue']}/comment
    customHeaders:
      Authorization: Basic USER/PASSWORD-BASE64
      Content-Type: application/json
    payload: |-
      {
        "body": "${parameterValues['message']}",
        "public": true
      }
    parameters:
    - label: Issue ID
      name: issue
      description: Issue
      type: string
    - label: Message
      name: message
      description: message
      type: string
  - label: "ServiceDesk: Wait for state-OpsMx"
    type: waitservicedeskstate
    enabled: true
    description: Stage that waits for a specific state on a Servicedesk issue
    method: GET
    url: https://<URL>/rest/servicedeskapi/request/${parameterValues['issue']}/status
    customHeaders:
      Authorization: Basic USER/PASSWORD-BASE64
      Content-Type: application/json
    failPipeline: true
    progressJsonPath: "values[0].status"
    payload: ""
    retryStatusCodes:
      - 200
    statusJsonPath: "values[0].status"
    statusUrlResolution: "getMethod"
    successStatuses: ${parameterValues['success']}
    retryStatuses: ${parameterValue['retry']}
    canceledStatuses: ${parameterValues['cancel']}
    waitBeforeMonitor: "1"
    waitForCompletion: true
    parameters:
    - label: ServiceDesk Issue ID
      name: issue
      description: "The ServiceDesk issue, the default relies on ServiceDesk issue ID extraction"
      type: string
      defaultValue:
    - label: ServiceDesk Retry States
      name: retry
      description: "ServiceDesk issue states that Retry the stage e.g,: To Do, In Progress, etc."
      type: string
      defaultValue: To Do, In Progress
    - label: ServiceDesk Success States
      name: success
      description: "ServiceDeskissue States that progress the pipeline, e.g,: In Verificaiton etc."
      type: string
      defaultValue: In Verification
    - label: ServiceDesk Canceled States
      name: cancel
      description: "ServiceDesk issue states that cancel the pipeline e.g,: Done, etc."
      type: string
      defaultValue: Done
  - label: "ServiceDesk: Transition issue-OpsMx"
    type: transservicedesk issue status
    enabled: true
    description: Stage that transitions an Servicedesk request status
    method: POST
    url: https://<URL>/rest/servicedeskapi/request/${parameterValues['issue']}/transition
    customHeaders:
      Authorization: Basic USER/PASSWORD-BASE64
      Content-Type: application/json
      X-ExperimentalApi: opt
    payload: |-
     {
        "id": "${parameterValues['targetStageID']}",
        "additionalComment": {
            "body": "${parameterValues['body']}"
        }
     }
    parameters:
    - label: Issue ID
      name: issue
      description: Issue
      type: string
    - label: Target Stage ID
      name: targetStageID
      description: Target ID from the workflow of project
      type: string
    - label: Body
      name: body
      description: Current status as a comment to change the transition
      type: string
spinnaker:
  extensibility:
    plugins:
      Opsmx.VerificationGatePlugin:
        enabled: true
        version: 1.0.1
        config:
      Opsmx.VisibilityApprovalPlugin:
        enabled: true
        version: 1.0.1
        config:
      Opsmx.TestVerificationGatePlugin:
        enabled: true
        version: 1.0.1
        config:
      Opsmx.PolicyGatePlugin:
        enabled: true
        version: 1.0.1
        config:
      Opsmx.RbacPlugin:
        enabled: true
        version: 1.0.1
        config:
policy:
  opa:
    enabled: true
    url: http://oes-sapor:8085
pipeline:
  rbac: false    
